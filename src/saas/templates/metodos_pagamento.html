{% extends 'base_contratacao.html' %}
{% load crispy_forms_tags %}
{% load static %}


{% block main_content %}

    <h1>Métodos de pagamento</h1>
    <p>{{ cartoes_count }} {% if cartoes_count == 1 %}cartão cadastrado.{% else %}cartões cadastrados.{% endif %}</p>

    <h2 class="h3 mb-3">Cartão padrão</h2>
    <section class="container mt-2">
        <div class=" row row-cols-lg-auto justify-content-between"
            style="border-radius: 0.5rem; border: 2px solid {% if cartao_padrao.bandeira == bandeiras.VISA %}#0093E9{% elif cartao_padrao.bandeira == bandeiras.MASTERCARD %}#ff1100{% else %}#007bff{% endif %};">
            <div class="h5 mx-3 my-4">
                <span class="d-block small text-secondary" style="font-size: 0.8rem;">Bandeira:</span>{{ cartao_padrao.get_bandeira_display }}
            </div>
            <div class="h5 mx-3 my-4">
                <span class="d-block small text-secondary" style="font-size: 0.8rem;">Titular:</span>{{ cartao_padrao.nome_titular }}
            </div>
            <div class="h5 mx-3 my-4">
                <span class="d-block small text-secondary" style="font-size: 0.8rem;">Número:</span>**** **** **** {{ cartao_padrao.numero }}
            </div>
            <div class="h5 mx-3 my-4">
                <span class="d-block small text-secondary" style="font-size: 0.8rem;">Validade:</span>{{ cartao_padrao.mes_validade|stringformat:"02d" }}/{{ cartao_padrao.ano_validade|stringformat:"d"|slice:"-2:" }}
            </div>
        </div>
    </section>


    {% if cartoes_count == 0 %}
        <div class="alert alert-info" role="alert">
            Nenhum cartão cadastrado.
        </div>
    {% else %}
        <h2 class="h3 mt-4">Outros cartões</h2>
        <button type="button" class="btn btn-primary mb-3 mt-2" data-bs-toggle="modal" data-bs-target="#addCartaoModal">
            Adicionar Cartão
        </button>
        <section id="lista-metodos-pagamento" class="container mt-4 ps-0">
            <div class="row row-cols-1 row-cols-md-3 g-4">
                {% for cartao in cartoes %}
                    {% include 'cards/card_metodo_pagamento.html' %}
                {% endfor %}
            </div>
        </section>
    {% endif %}

    <div class="modal fade" id="addCartaoModal" tabindex="-1" aria-labelledby="addCartaoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addCartaoModalLabel">Adicionar Cartão</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="payment-form" data-public-key="{{ public_key }}" method="post">
                        {% csrf_token %}
                        <div id="card-element" class="form-group mb-3"><!-- Stripe Element --></div>
                        <div class="row g-3 align-items-end">
                            <div class="col-auto">
                                {{ cadastrar_cartao_form.cep|as_crispy_field }}
                            </div>
                            <div class="col-auto">
                                {{ cadastrar_cartao_form.numero_residencial|as_crispy_field }}
                            </div>
                            <div class="col">
                                {{ cadastrar_cartao_form.complemento|as_crispy_field }}
                            </div>
                        </div>
                        <div class="row g-3 align-items-end">
                            <div class="col">
                                {{ cadastrar_cartao_form.nome_titular|as_crispy_field }}
                            </div>
                            <div class="col-auto">
                            </div>
                        </div>
                        <button name="{{ cadastrar_cartao_form.submit_name }}"
                            value="{{ cadastrar_cartao_form.get_submit_button.value }}"
                            id="cadastro-cartao-btn"  
                            type="button"
                            class="btn btn-block w-100 btn-primary mb-3">
                            Cadastrar
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

{% endblock main_content %}

{% block styles %}
    <link href="{% static 'styles/payment-method-form-style.css' %}" rel="stylesheet" >
    <link href="{% static 'styles/payment-method-style.css' %}" rel="stylesheet" >
{% endblock styles %}

{% block scripts %}
    <script src="https://js.stripe.com/v3/"></script>
    <script src="{% static 'scripts/cadastrar_cartao.js' %}"></script>
{% endblock scripts %}
